require('dotenv').config();
const { Bot, GrammyError, HttpError, Keyboard, InlineKeyboard } = require('grammy');
const fs = require('fs');
const { logger } = require('./utils/logger');
const { updateUserData, isAdmin, createKeyboard } = require('./utils/helpers');
const { socialNetworks, promoCodes } = require('./utils/buttons');

// Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€Ð° Ð±Ð¾Ñ‚Ð°
const bot = new Bot(process.env.BOT_API_KEY);

// Ð¤Ð°Ð¹Ð», Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð±ÑƒÐ´ÑƒÑ‚ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒÑÑ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÑ…
const userDataFile = 'userData.json';

// ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° userData.json Ð¸ ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ ÐµÐ³Ð¾, ÐµÑÐ»Ð¸ Ð¾Ð½ Ð½Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
if (!fs.existsSync(userDataFile)) {
  fs.writeFileSync(userDataFile, '{}');
}

let userData = JSON.parse(fs.readFileSync(userDataFile));

bot.command('start', async (ctx) => {
  // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð±Ð¾Ñ‚ Ð²Ð¿ÐµÑ€Ð²Ñ‹Ðµ
  if (!userData[ctx.from.id]) {
    // Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ Ð±Ð¾Ñ‚ Ð²Ð¿ÐµÑ€Ð²Ñ‹Ðµ, Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ðµ
    updateUserData(userDataFile, ctx.from.id);
  }
  const startKeyboard = new Keyboard()
    .text('ðŸ™‹â€â™‚ï¸ ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐºÐ°')
    .row()
    .text('ðŸ“² Ð¡Ð¾Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐµÑ‚Ð¸')
    .row()
    .text('ðŸ”¥ ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñ‹ Ð¸ ÑÐºÐ¸Ð´ÐºÐ¸')
    .row()
  await ctx.reply(
    'ÐŸÑ€Ð¸Ð²ÐµÑ‚! Ð¯ Ð±Ð¾Ñ‚ Ð¿Ð¾Ð¼Ð¾ÑˆÐ½Ð¸Ðº ÐºÐ°Ð½Ð°Ð»Ð° Ð¢ÐµÑ…Ð½Ð¾Ð¼Ð°Ð½ÑŒÑÐº!',
  );
  await ctx.reply('Ð¡ Ñ‡ÐµÐ³Ð¾ Ð½Ð°Ñ‡Ð½ÐµÐ¼? Ð’Ñ‹Ð±Ð¸Ñ€Ð°Ð¹ ðŸ‘‡', {
    reply_markup: startKeyboard,
  });
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°
bot.command('admin', async (ctx) => {
  // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÑÐ²Ð»ÑÐµÑ‚ÑÑ Ð»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼
  if (isAdmin(ctx.from.id, process.env.ADMIN_ID)) {
    // Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð±Ð¾Ñ‚Ð°
    let totalStarts = 0;
    for (const userId in userData) {
      totalStarts += userData[userId].timesStarted;
    }
    await ctx.reply(`Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð±Ð¾Ñ‚Ð°:\nÐ’ÑÐµÐ³Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ¾Ð²: ${totalStarts}`);
  } else {
    await ctx.reply('Ð£ Ð²Ð°Ñ Ð½ÐµÑ‚ Ð¿Ñ€Ð°Ð² Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°!');
  }
});

// Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¹ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ¸
function handleButtonClicks(items) {
  items.forEach(item => {
      bot.hears(item.name, async (ctx) => {
          let message = '';
          if (item.type === 'social') {
              message = `Ð’Ð¾Ñ‚ ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° ${item.name}: ${item.url}`;
          } else if (item.type === 'promo') {
              message = `Ð’Ð¾Ñ‚ ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° ${item.name}: ${item.url}\n\nÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´: ${item.code}\n\nÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ: ${item.description}`;
          }
          await ctx.reply(message);
      });
  });
}

bot.hears('ðŸ“² Ð¡Ð¾Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐµÑ‚Ð¸', async (ctx) => {
  const socialKeyboard = createKeyboard(socialNetworks);
  await ctx.reply('Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ¾Ñ†Ð¸Ð°Ð»ÑŒÐ½ÑƒÑŽ ÑÐµÑ‚ÑŒ:', {
    reply_markup: socialKeyboard,
  });
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ "ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñ‹ Ð¸ ÑÐºÐ¸Ð´ÐºÐ¸"
bot.hears('ðŸ”¥ ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñ‹ Ð¸ ÑÐºÐ¸Ð´ÐºÐ¸', async (ctx) => {
  const promoKeyboard = createKeyboard(promoCodes);
  await ctx.reply('Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ð¾Ð² Ð¸ ÑÐºÐ¸Ð´Ð¾Ðº:', {
    reply_markup: promoKeyboard,
  });
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ "ÐÐ°Ð·Ð°Ð´"
bot.hears('ÐÐ°Ð·Ð°Ð´ â†©ï¸', async (ctx) => {
  const startKeyboard = new Keyboard()
    .text('ðŸ™‹â€â™‚ï¸ ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐºÐ°')
    .row()
    .text('ðŸ“² Ð¡Ð¾Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐµÑ‚Ð¸')
    .row()
    .text('ðŸ”¥ ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñ‹ Ð¸ ÑÐºÐ¸Ð´ÐºÐ¸')
    .row()
  await ctx.reply('Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:', {
    reply_markup: startKeyboard,
  });
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¹ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ¸ ÑÐ¾Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ñ… ÑÐµÑ‚ÐµÐ¹
handleButtonClicks(socialNetworks);

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ð¹ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ð¾Ð² Ð¸ ÑÐºÐ¸Ð´Ð¾Ðº
handleButtonClicks(promoCodes);

// ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð¾Ð¹
bot.hears('ðŸ“² Ð¡Ð¾Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐµÑ‚Ð¸', async (ctx) => {
  await ctx.reply('Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ¾Ñ†Ð¸Ð°Ð»ÑŒÐ½ÑƒÑŽ ÑÐµÑ‚ÑŒ:', {
    reply_markup: socialKeyboard,
  });
});

// ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ð¾Ð¹
bot.hears('ðŸ”¥ ÐŸÑ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñ‹ Ð¸ ÑÐºÐ¸Ð´ÐºÐ¸', async (ctx) => {
  await ctx.reply('Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ:', {
    reply_markup: promoKeyboard,
  });
});

// Ð¤Ð»Ð°Ð³ Ð´Ð»Ñ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°Ð½Ð¸Ñ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ñ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐºÐ°" Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÐµÐµ Ð½Ð°Ð¶Ð°Ð»
let suggestionClicked = {};

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ "ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐºÐ°"
bot.hears('ðŸ™‹â€â™‚ï¸ ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐºÐ°', async (ctx) => {
  // Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ñ„Ð»Ð°Ð³ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ñ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐºÐ°" Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
  suggestionClicked[ctx.from.id] = true;
  await ctx.reply('ÐžÐ¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¸Ð»Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð²Ñ‹ Ñ…Ð¾Ñ‚ÐµÐ»Ð¸ Ð±Ñ‹ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð°Ð²Ñ‚Ð¾Ñ€Ñƒ Ð±Ð¾Ñ‚Ð°.');
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð²ÑÐµÑ… Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ñ… ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿ÐµÑ€ÐµÑÑ‹Ð»Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð°Ð²Ñ‚Ð¾Ñ€Ñƒ Ð±Ð¾Ñ‚Ð°
bot.on('message', async (ctx) => {
  const authorId = process.env.ADMIN_ID;
  
  // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð±Ñ‹Ð»Ð° Ð»Ð¸ Ð½Ð°Ð¶Ð°Ñ‚Ð° ÐºÐ½Ð¾Ð¿ÐºÐ° "ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐºÐ°" Ð¿ÐµÑ€ÐµÐ´ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¾Ð¹ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
  if (suggestionClicked[ctx.from.id]) {
    // ÐŸÐµÑ€ÐµÑÑ‹Ð»Ð°ÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð°Ð²Ñ‚Ð¾Ñ€Ñƒ Ð±Ð¾Ñ‚Ð°
    if (ctx.message.text) {
      // Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
      await ctx.forwardMessage(authorId, { text: ctx.message.text });
    } else if (ctx.message.voice) {
      // Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ
      await ctx.forwardMessage(authorId, { voice: ctx.message.voice });
    } else if (ctx.message.photo) {
      // Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ Ñ„Ð¾Ñ‚Ð¾
      await ctx.forwardMessage(authorId, { photo: ctx.message.photo });
    } else if (ctx.message.video) {
      // Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ Ð²Ð¸Ð´ÐµÐ¾
      await ctx.forwardMessage(authorId, { video: ctx.message.video });
    } else {
      // Ð•ÑÐ»Ð¸ ÑÑ‚Ð¾ Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ñ‚Ð¸Ð¿ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ, Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ ÐµÐ³Ð¾ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÐµÐ½Ð½Ð¾
      await ctx.forwardMessage(authorId, ctx.message);
    }
    
    // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð¾ Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾ ÐµÐ³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾ Ð°Ð²Ñ‚Ð¾Ñ€Ñƒ
    await ctx.reply('Ð’Ð°ÑˆÐµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾ Ð°Ð²Ñ‚Ð¾Ñ€Ñƒ Ð±Ð¾Ñ‚Ð°');

    // Ð¡Ð±Ñ€Ð°ÑÑ‹Ð²Ð°ÐµÐ¼ Ñ„Ð»Ð°Ð³ Ð½Ð°Ð¶Ð°Ñ‚Ð¸Ñ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐºÐ°" Ð¿Ð¾ÑÐ»Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
    suggestionClicked[ctx.from.id] = false;
  } else {
    // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ Ð¾ Ñ‚Ð¾Ð¼, Ñ‡Ñ‚Ð¾ ÑÐ½Ð°Ñ‡Ð°Ð»Ð° Ð½ÑƒÐ¶Ð½Ð¾ Ð½Ð°Ð¶Ð°Ñ‚ÑŒ ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐºÐ°"
    await ctx.reply('ÐŸÐ¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, ÑÐ½Ð°Ñ‡Ð°Ð»Ð° Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐŸÑ€ÐµÐ´Ð»Ð¾Ð¶ÐºÐ°" Ð´Ð»Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð°Ð²Ñ‚Ð¾Ñ€Ñƒ ÐºÐ°Ð½Ð°Ð»Ð°!');
  }
});


//ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð±Ð¾Ñ‚Ð° Ð¸ Ð¸Ñ… Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ
bot.api.setMyCommands([
  {
    command:'start', 
    description: 'Ð¡Ñ‚Ð°Ñ€Ñ‚ Ð±Ð¾Ñ‚Ð°',
  },
]);

//ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¾ÑˆÐ¸Ð±Ð¾Ðº
bot.catch((err) => {
  const ctx = err.ctx;
  logger.error(`Error while handling update ${ctx.update.update_id}:`);
  const e = err.error;

  if (e instanceof GrammyError) {
    logger.error("Error in request:", e.description);
  } else if (e instanceof HttpError) {
    logger.error("Could not contact Telegram:", e);
  } else {
    logger.error("Unknown error:", e);
  }
  });

bot.start();